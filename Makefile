WORMCHAIN_PATH=../wormhole/wormchain/
WORM_CLIENT_PATH=../wormhole/clients/js

CORE_ADDR=wormhole1ghd753shjuwexxywmgs4xz7x2q732vcnkm6h2pyv9s6ah3hylvrqtm7t3h
TB_ADDR=wormhole1eyfccmjm6732k7wp4p6gdjwhxjwsvje44j0hfx8nkgrm8fs7vqfssvpdkx
IBC_TR_ADDR=wormhole1wn625s4jcmvk0szpl85rj5azkfc6suyvf75q6vrddscjdphtve8sca0pvl

BASE_VAA=01000000000000000001000001a50001c69a1b1a65dd336bf1df6a77afb501fc25db7fc0938cb08595a9ef473265cb4f000000000517937500010000000000000000000000000000000000000000000000000000000005f5e100165809739240a0ac03b98440fe8985548e3aa683cd0d4d9df5b5659669faa3010001000000000000000000000000c10820983f33456ce7beb3a046f5a83fa34f027d0c200000000000000000000000000000000000000000000000000000000000000000

ATTEST_VAA=AQAAAAABAKoxcgK6/q+6ZrqH8iX+ejpAsexkyu2wxI+KHB5ktmxDaajVSjbtL70c4jPyDCw7BYUG5hmQ+EIsuyGJiZGGNaEBAAAAAQAAAAEAAcaaGxpl3TNr8d9qd6+1Afwl23/Ak4ywhZWp70cyZctPAAAAAAUXk3QAAhZYCXOSQKCsA7mEQP6JhVSOOqaDzQ1NnfW1ZZZp+qMBAAEGU09MVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB3U09MVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==
VAA=AQAAAAABAGNgCWY1USMq/KKRE631pyA+qNrGjXUAlsMZlQ7C2hAxJ9dYw8HDAMLpTtxFps1hQde330RHMpm7Q0MvfKEpOmcAAAAAAQABIcYAAcaaGxpl3TNr8d9qd6+1Afwl23/Ak4ywhZWp70cyZctPAAAAAAAEMSEAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7msoAFlgJc5JAoKwDuYRA/omFVI46poPNDU2d9bVllmn6owEAAXT0qkKyxtlnwEH56DlTorJxqHCMT6gNMG1sMSaG62ZPDCDGmhsaZd0za/HfanevtQH8Jdt/wJOMsIWVqe9HMmXLT3siZ2F0ZXdheV90cmFuc2ZlciI6eyJjaGFpbiI6MTgsImZlZSI6IjAiLCJub25jZSI6Nzc5OTIsInJlY2lwaWVudCI6InRlcnJhMXg0NnJxYXk0ZDNjc3NxOGd4eHZxejh4dDZud2x6NHRkMjBrMzh2In19
TEST_VAA=AQAAAAABAPh3uz7xSToTVhjBDRfIP0xZT3+JsNIHFzBIK973PuIoAIiiCjDbPAZiDwJMQN1Ek0/14kIGOfq6Q7/O50Yvx4kBAAAAAQABIcYAAcaaGxpl3TNr8d9qd6+1Afwl23/Ak4ywhZWp70cyZctPAAAAAAAEMSEAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7msoAFlgJc5JAoKwDuYRA/omFVI46poPNDU2d9bVllmn6owEAAXT0qkKyxtlnwEH56DlTorJxqHCMT6gNMG1sMSaG62ZPDCDGmhsaZd0za/HfanevtQH8Jdt/wJOMsIWVqe9HMmXLT3siZ2F0ZXdheV90cmFuc2ZlciI6eyJjaGFpbiI6MTgsImZlZSI6IjAiLCJub25jZSI6Nzc5OTIsInJlY2lwaWVudCI6ImRHVnljbUV4ZURRMmNuRmhlVFJrTTJOemMzRTRaM2g0ZG5GNk9IaDBObTUzYkhvMGRHUXlNR3N6T0hZPSJ9fQ==
UPDATE_CHANNEL_VAA=AQAAAAABADgdiqQeZkn5mTv35wS2yCeaR7VuHldj+jbJE4L2w26LTvOC2MGO0IoV8H2lz8BOgXrYe76jj1Zvrmpzw26T1UwBAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAGZ2YwAAAAAAAAAAAAAAAAAAAAAAAAAAEliY1RyYW5zbGF0b3IBDCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY2hhbm5lbC0wABI=

FROM=wormhole1cyyzpxplxdzkeea7kwsydadg87357qna3zg3tq
SIGN_SEND_FLAGS=--chain-id wormchain -bblock --fees=1000000uworm --yes --gas-adjustment=2 --gas=1000000 --from $(FROM)
NODE=--node=http://localhost:26659/

MESSAGE='{"complete_transfer_and_convert":{"vaa":"$(TEST_VAA)"}}'
complete-ibc-transfer:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind --trace \
	tx wasm execute $(IBC_TR_ADDR) \
	$(MESSAGE) \
	$(NODE) \
	$(SIGN_SEND_FLAGS)

TRANSFER_INFO_MESSAGE='{"transfer_info":{"vaa":"$(TEST_VAA)"}}'
get-transfer-info:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	q wasm contract-state smart --trace $(TB_ADDR) \
	$(TRANSFER_INFO_MESSAGE) \
	$(NODE) -o json | jq .

PV_MESSAGE='{"verify_v_a_a":{"vaa":"$(TEST_VAA)", "block_time": 14145 }}'
parse-verify-vaa:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	q wasm contract-state smart --trace $(CORE_ADDR) \
	$(PV_MESSAGE) \
	$(NODE)

GS_MESSAGE='{"guardian_set_info":{}}'
query-guardian-set:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	q wasm contract-state smart --trace $(CORE_ADDR) \
	$(GS_MESSAGE) \
	$(NODE)


ATTEST_MESSAGE='{"submit_vaa":{"data":"$(ATTEST_VAA)"}}'
attest-token:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	tx wasm execute $(TB_ADDR) \
	$(ATTEST_MESSAGE) \
	$(NODE) \
	$(SIGN_SEND_FLAGS)

check-cw20-instances:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	q wasm list-contract-by-code 6 --node http://localhost:26659 -o json | jq .

UPDATE_CHANNEL_INFO_MSG='{"submit_update_chain_to_channel_map":{"vaa":"$(UPDATE_CHANNEL_VAA)"}}'
update-channel-info:
	cd $(WORMCHAIN_PATH) && ./build/wormchaind \
	tx wasm execute $(IBC_TR_ADDR) \
	$(UPDATE_CHANNEL_INFO_MSG) \
	$(NODE) \
	$(SIGN_SEND_FLAGS)

NEW_PAYLOAD=03000000000000000000000000000000000000000000000000000000003b9aca00165809739240a0ac03b98440fe8985548e3aa683cd0d4d9df5b5659669faa301000174f4aa42b2c6d967c041f9e83953a2b271a8708c4fa80d306d6c312686eb664f0c20c69a1b1a65dd336bf1df6a77afb501fc25db7fc0938cb08595a9ef473265cb4f7b22676174657761795f7472616e73666572223a7b22636861696e223a31382c22666565223a2230222c226e6f6e6365223a37373939322c22726563697069656e74223a225b302c202020302c202020302c202020302c202020302c202020302c202020302c202020302c202020302c302c202020302c202020302c202035332c203131362c202034382c203131362c203134392c203130382c3131332c202020382c202020302c203233322c202034392c203135322c202020312c202032382c203230332c3231322c203232312c203234312c202038352c203130395d227d7d
edit-vaa:
	cd $(WORM_CLIENT_PATH) && worm edit-vaa -n devnet \
	--gsi 0 \
	--nonce 74182 \
	--ec 1 \
	--ea 0xc69a1b1a65dd336bf1df6a77afb501fc25db7fc0938cb08595a9ef473265cb4f \
	--seq 274721 \
	--payload $(NEW_PAYLOAD) \
	--gs cfb12303a19cde580bb4dd771639b0d26bc68353645571a8cff516ab2ee113a0 \
	--vaa $(BASE_VAA)

sign-vaa:
	cd $(WORM_CLIENT_PATH) && worm edit-vaa -n devnet \
	--gs cfb12303a19cde580bb4dd771639b0d26bc68353645571a8cff516ab2ee113a0 \
	--vaa $(TEST_VAA)
